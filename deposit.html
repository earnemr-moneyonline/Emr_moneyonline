<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deposit | EMR Business</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #020617; --gold: #ffc947; --card: #1e293b; --error: #ff4757; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: white; padding: 20px; padding-bottom: 50px; }

        .header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .header h3 { font-size: 1.2rem; }

        /* Payment Selector */
        .section-title { font-size: 0.85rem; color: var(--gold); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .method-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        
        .method-item { 
            background: var(--card); border-radius: 12px; padding: 10px; text-align: center;
            border: 2px solid transparent; cursor: pointer; transition: 0.3s;
        }
        .method-item.active { border-color: var(--gold); background: rgba(255, 201, 71, 0.1); }
        .method-item img { width: 100%; height: 45px; object-fit: contain; margin-bottom: 5px; border-radius: 5px; }
        .method-item p { font-size: 0.65rem; font-weight: 600; }

        /* Instructions Box */
        .instruction-card { 
            background: #0f172a; border: 1px solid #334155; border-radius: 15px; 
            padding: 20px; margin-bottom: 20px; display: none; animation: slideIn 0.4s ease;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .step { display: flex; gap: 10px; margin-bottom: 10px; font-size: 0.85rem; line-height: 1.4; }
        .step-num { background: var(--gold); color: #000; width: 20px; height: 20px; border-radius: 50%; 
                    display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.7rem; flex-shrink: 0; }

        /* Form Styling */
        .input-box { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; opacity: 0.7; margin-bottom: 8px; }
        input { 
            width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #334155; 
            background: var(--card); color: white; outline: none; font-size: 1rem;
        }
        input:focus { border-color: var(--gold); }

        .min-alert { color: var(--error); font-size: 0.7rem; margin-top: 5px; display: none; }

        .btn-pay { 
            width: 100%; padding: 18px; background: var(--gold); border: none; 
            border-radius: 15px; font-weight: 800; color: #000; cursor: pointer; 
            font-size: 1rem; margin-top: 10px;
        }
    </style>
</head>
<body>

    <div class="header">
        <a href="merchant_dashboard.html" style="color:white"><i class="fas fa-chevron-left"></i></a>
        <h3>Weka Salio</h3>
    </div>

    <p class="section-title">Chagua Njia ya Malipo</p>
    <div class="method-grid">
        <div class="method-item" onclick="showGuide('mpesa')">
            <img src="https://upload.wikimedia.org/wikipedia/en/d/df/M-pesa_logo.png" alt="Mpesa">
            <p>M-Pesa</p>
        </div>
        <div class="method-item" onclick="showGuide('tigo')">
            <img src="https://logos-world.net/wp-content/uploads/2022/11/Tigo-Logo.png" alt="Tigo">
            <p>TigoPesa</p>
        </div>
        <div class="method-item" onclick="showGuide('airtel')">
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Airtel_logo.png" alt="Airtel">
            <p>Airtel</p>
        </div>
        <div class="method-item" onclick="showGuide('halopesa')">
            <img src="https://halopesa.co.tz/wp-content/uploads/2021/03/halopesa-logo.png" alt="Halopesa">
            <p>HaloPesa</p>
        </div>
        <div class="method-item" onclick="showGuide('nmb')">
            <img src="https://www.nmbbank.co.tz/images/nmb-logo.png" alt="NMB">
            <p>NMB Bank</p>
        </div>
        <div class="method-item" onclick="showGuide('crdb')">
            <img src="https://crdbbank.co.tz/wp-content/uploads/2020/06/CRDB-Logo.png" alt="CRDB">
            <p>CRDB Bank</p>
        </div>
    </div>

    <div id="guide-box" class="instruction-card">
        <h4 id="guide-title" style="margin-bottom:15px; color:var(--gold)">Maelekezo</h4>
        <div id="steps-container"></div>
    </div>

    <div class="input-box">
        <label>Kiasi unachoweka (Kima cha chini 5,000)</label>
        <input type="number" id="amount" placeholder="5,000" oninput="validateAmount()">
        <p id="min-error" class="min-alert">Kiwango cha chini ni TZS 5,000</p>
    </div>

    <div class="input-box">
        <label>Namba ya Kumbukumbu / Transaction ID</label>
        <input type="text" id="trans_id" placeholder="Mfano: RY92LM30S">
    </div>

    <button class="btn-pay" onclick="processDeposit()">WASILISHA MALIPO</button>

    <script>
        const guides = {
            mpesa: {
                title: "Lipia kwa M-Pesa",
                steps: [
                    "Piga *150*00#",
                    "Chagua 4 (Lipa kwa M-Pesa)",
                    "Chagua 4 (Weka namba ya kampuni)",
                    "Weka namba ya kampuni: 0740430220",
                    "Weka kiasi na namba ya siri",
                    "Nakili kodi ya muamala (Transaction ID) na uweke hapa chini."
                ]
            },
            tigo: {
                title: "Lipia kwa Tigo Pesa",
                steps: [
                    "Piga *150*01#",
                    "Chagua 5 (Lipa kwa Simu)",
                    "Chagua 1 (Kwenda Tigo Pesa)",
                    "Weka namba: 065XXXXXXX",
                    "Weka kiasi na siri",
                    "Ingiza Transaction ID hapa chini."
                ]
            },
            nmb: {
                title: "Lipia kwa NMB Bank",
                steps: [
                    "Fungua NMB App au Piga *150*66#",
                    "Chagua 'Transfer' kwenda NMB",
                    "Weka Akaunti: 22XXXXXXXXX",
                    "Jina: EMR MONEY GROUP",
                    "Weka Transaction ID baada ya kukamilisha."
                ]
            }
            // ... Unaweza kuongeza mingine hapa
        };

        function showGuide(method) {
            document.querySelectorAll('.method-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            const guide = guides[method] || { title: "Maelekezo", steps: ["Tuma kiasi kwenda namba 0740430220 (EMR MONEY)", "Weka Transaction ID hapa chini."] };
            
            document.getElementById('guide-title').innerText = guide.title;
            const container = document.getElementById('steps-container');
            container.innerHTML = guide.steps.map((s, i) => `
                <div class="step">
                    <span class="step-num">${i+1}</span>
                    <p>${s}</p>
                </div>
            `).join('');
            
            document.getElementById('guide-box').style.display = 'block';
        }

        function validateAmount() {
            const val = document.getElementById('amount').value;
            document.getElementById('min-error').style.display = (val < 5000) ? 'block' : 'none';
        }

        async function processDeposit() {
            const amt = document.getElementById('amount').value;
            const tid = document.getElementById('trans_id').value;

            if (amt < 5000) { alert("Kiwango cha chini ni 5,000"); return; }
            if (!tid) { alert("Weka Transaction ID"); return; }

            alert("Ombi lako la TZS " + amt + " limepokelewa. Tunahakiki...");
            // Hapa weka kodi ya Supabase insert kama tulivyofanya awali
        }
    </script>
</body>
</html>
